<!DOCTYPE html>
<!-- saved from url=(0062)http://webrtc.github.io/samples/src/content/getusermedia/face/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript" src="./WebRTC Face Reco Demo Application_files/ccv.js"></script>
  <script type="text/javascript" src="./WebRTC Face Reco Demo Application_files/face.js"></script>
 
   <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script type="text/javascript" src="http://github.com/weepy/jquery.path/raw/master/jquery.path.js"></script>
 
  <!-- Load the polyfill to switch-hit between Chrome and Firefox -->
  <script src="./WebRTC Face Reco Demo Application_files/adapter.js"></script>
  <style type="text/css">
    display: block;display: block;* { margin:0; padding:0; } /* to remove the top and left whitespace */
    html, body { width:100%; height:100%; } /* just to be sure these are full screen*/
    body {font-family: 'Helvetica';background-color: #000000; }
    a:link { color: #ffffff; } a:visited {color: #ffffff; }

    #localCanvas {
      display: block;
      position: absolute;
      width: 100%;
      height: 100%;
    }

    #localVideo {
      display: block;
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      width: 100%;
      height: 100%;
      -webkit-transition-property: opacity;
      -webkit-transition-duration: 2s;
      opacity: 0;
    }
    #logo {
      display: block;
      top:4;
      right:4;
      position:absolute;
      float:right;
      #opacity: 0.8;
    }

    #credit {
      display: block;
      top:28;
      right:4;
      position:absolute;
      float:right;
      font-size:10px;
    }
	
	.rotating {
		position:absolute;
		width:auto;
		height:20vw;
		top: 30vh;
		-webkit-transform-style: preserve-3d;
             -moz-transform-style: preserve-3d;
               -o-transform-style: preserve-3d;
                  transform-style: preserve-3d;
                        -webkit-transform: rotateY( 180deg );
         -moz-transform: rotateY( 0deg );
           -o-transform: rotateY( 0deg );
              transform: rotateY( 0deg );
	}

  </style>
  <title>WebRTC Face Reco Demo Application</title>
</head>
<body>

  <script type="text/javascript">
    var localVideo;
    var localCanvas;

    initialize = function() {
      localVideo = document.getElementById("localVideo");
      localCanvas = document.getElementById("localCanvas");
      try {
        navigator.getUserMedia({video:true}, onGotStream, onFailedStream);
    //trace("Requested access to local media");
  } catch (e) {
    alert("getUserMedia error " + e);
    //trace_e(e, "getUserMedia error");
  }
}

function rotateFunction(object, xVal, widthVal, videoWidth) {
	var screen_offset = window.screenX;
	var position_offset = object.offsetLeft;
	var width_offset = object.offsetWidth/2;
	var total_offset = screen_offset+position_offset + width_offset;
	var screen_width = window.screen.width;
	var item_from_center = (total_offset - (screen_width/2)) / (screen_width/2);
	
	var face_point = xVal + widthVal/2;
	var face_from_center = (face_point - (videoWidth/2)) / (videoWidth / 2); 
	var angleX = item_from_center + face_from_center;
	
	//$("#spin").css({ transform: 'rotate3d(.5, ' + angleX + ', 0, 50deg'});		
	$(object).css({ transform: 'rotateY(' + angleX * -15 + 'deg)'});	

}

poll = function() {
  var w = localVideo.videoWidth;
  var h = localVideo.videoHeight;
  var canvas = document.createElement('canvas');
  canvas.width  = w;
  canvas.height = h;
  var ctx = canvas.getContext('2d');
  ctx.drawImage(localVideo, 0, 0, w, h);
  var comp = ccv.detect_objects({ "canvas" : ccv.grayscale(canvas),
                                "cascade" : cascade,
                                "interval" : 5,
                                "min_neighbors" : 1 });
   

  /* draw detected area */
  localCanvas.width = localVideo.clientWidth;
  localCanvas.height = localVideo.clientHeight;

  var ctx2 = localCanvas.getContext('2d');
  ctx2.lineWidth = 2;
  ctx2.lineJoin = "round";
  ctx2.clearRect (0, 0, localCanvas.width,localCanvas.height);

  var x_offset = 0, y_offset = 0, x_scale = 1, y_scale = 1;
  if (localVideo.clientWidth * localVideo.videoHeight > localVideo.videoWidth * localVideo.clientHeight) {
    x_offset = (localVideo.clientWidth - localVideo.clientHeight *
                localVideo.videoWidth / localVideo.videoHeight) / 2;
  } else {
    y_offset = (localVideo.clientHeight - localVideo.clientWidth *
                localVideo.videoHeight / localVideo.videoWidth) / 2;
  }
  x_scale = (localVideo.clientWidth - x_offset * 2) / localVideo.videoWidth;
  y_scale = (localVideo.clientHeight - y_offset * 2) / localVideo.videoHeight;


	spin_box1 = document.getElementById("spin1");
	spin_box2 = document.getElementById("spin2");

// make require a certain confidence interval
// if above confidence interval, take the highest value
// make more efficient by taking out extraneous variables
	if (comp.length > 0) {
		rotateFunction(spin_box1, comp[0].x, comp[0].width, localVideo.videoWidth);
		rotateFunction(spin_box2, comp[0].x, comp[0].width, localVideo.videoWidth);
	}

  for (var i = 0; i < comp.length; i++) {

    comp[i].x = comp[i].x * x_scale + x_offset;
    comp[i].y = comp[i].y * y_scale + y_offset;
    comp[i].width = comp[i].width * x_scale;
    comp[i].height = comp[i].height * y_scale;

    var opacity = 0.1;
    if (comp[i].confidence > 0) {
      opacity += comp[i].confidence / 10;
      if (opacity > 1.0) opacity = 1.0;
    }

    //ctx2.strokeStyle = "rgba(255,0,0," + opacity * 255 + ")";
    ctx2.lineWidth = opacity * 10;
    ctx2.strokeStyle = "rgb(255,0,0)";
    ctx2.strokeRect(comp[i].x, comp[i].y, comp[i].width, comp[i].height);
	
  
	
  }
  setTimeout(poll, 10);
}


onGotStream = function(stream) {
  localVideo.style.opacity = 1;
  attachMediaStream(localVideo, stream);
  localStream = stream;

  //trace("User has granted access to local media. url = " + url);
  setTimeout(poll, 2000);
}

onFailedStream = function(error) {
  alert("Failed to get access to local media. Error code was " + error.code + ".");
  //trace_warning("Failed to get access to local media. Error code was " + error.code);
}


setTimeout(initialize, 1);
</script>

<video id="localVideo" autoplay muted="" src="blob:http%3A//webrtc.github.io/ebd379b7-6bee-4445-b6fd-db2d552cf27d" style="opacity: 1;"></video>
<canvas width="1310" height="690" id="localCanvas"></canvas>

<div style = "      -webkit-perspective: 600px;
         -moz-perspective: 600px;
           -o-perspective: 600px;
              perspective: 600px;">

<img id = "spin1" class = "rotating" src = "monet.jpg" style="left:65vw;"/>
<img id = "spin2" class = "rotating" src = "dali.jpg" style="left:10vw;"/>

<!--
<idv id = "spin" class="rotating" style="position:absolute; width:10vw; height:10vw; left:45vw; background-color:white;"></div>
-->
</div>

</body></html>